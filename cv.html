<!DOCTYPE html>
<html>
<head>
    <title>Générateur de CV</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <style>

        body {
            font-family: Arial, Helvetica, sans-serif;
            background-color: #333;
            color: #ffffff;
        }

        a {
          color: rgb(255, 255, 255);
          font-size:medium;
          text-decoration: underline;
        }

        a:hover{
          color: rgb(143, 60, 226);
        }

        li{
          color: rgb(143, 60, 226);
          margin-bottom: 10px;
        }
		
		.container{
		position:absolute;
		left:0%;
		height:100%;
		width:100vw;
		}
		
		.row{
		position:relative;
		display:flex;
		flex-wrap:wrap;
		width:100vw;
  }
		

    .image-container {
      left: 5%;
      width: 175px; /* Ajustez la largeur selon vos besoins */
      height: 225px; /* Ajustez la hauteur selon vos besoins */
      border: 1px solid #000; /* Ajoute une bordure à votre cadre */
      overflow: hidden; /* Masque tout contenu dépassant les limites du conteneur */
      position: relative; /* Permet de positionner l'image à l'intérieur du conteneur */
      border-radius: 5px;
    }

.image-container img {
  position: absolute; /* Positionne l'image à l'intérieur du conteneur */
  top: 55%; /* Place l'image au centre verticalement */
  left: 55%; /* Place l'image au centre horizontalement */
  width: 115%;
  transform: translate(-50%, -50%) rotate(3deg); /* Déplace l'image de 50% vers la gauche et le haut, puis la fait pivoter de 10 degrés */
}

      .name{
      color: white;  
      }
        
        h2 {
          position: relative;
          font-variant: small-caps;
          margin-top: 5%;
          color: rgb(143, 60, 226);
        }

        h3::first-letter {
            text-transform: uppercase;
        }

        h3 {
          left: 7%;
          position: relative;
          font-variant: small-caps;
        }

        h4 {
          text-transform: uppercase;
          position: relative;
          left: 2%;
          text-transform: capitalize;
        }

        h5 {
          text-transform: capitalize;
          position: relative;
          left: 0%;
        }

        h6 {
          text-transform: uppercase;
        }



        .description{
          position: relative;
          height: 150px;
          width: 350px;
          background: linear-gradient(145deg, rgba(255,255,255,0) 5%, rgba(110, 110, 110, 0.2) 100%);
          top: 25px;
          padding: 25px;
          border: solid rebeccapurple 5px;
          text-transform:none;
        }
        .description::before {
          content: "";
          position: absolute;
          top: 0;
          left: -5px;
          border-left: solid #333 6px ;
          transform: translateY(10px);
          height: 120px;
        }
        .description::before {
          content: "";
          position: absolute;
          top: 0;
          right: -5px;
          border-right: solid #333 6px ;
        }
        .description::after {
          content: "";
          position: absolute;
          top: 0;
          top: -5px;
          border-top: solid #333 6px ;
          transform: translateX(-41%);
          width: 310px;
        }

        .description::after {
          content: "";
          position: absolute;
          bottom: 0;
          bottom: -5px;
          border-bottom: solid #333 6px ;
        }


        .card {
            position: relative;
            left: -10%;
            padding-top: 30px;
            padding-right: 40px;
            padding-left: 10px;
            margin-bottom: 5px;
            border: none;
            background: linear-gradient(145deg, rgba(255,255,255,0) 5%, rgba(102, 51, 153, 0.5) 100%);
            border-radius: 0px;
        }

        .card::before {
          content: "";
          position: absolute;
          top: 0;
          left: -2%;
          border-left: solid 7px rebeccapurple;
          transform: translateY(10%);
          height: 80%;
        }

        #schoolCards {
            position: relative;
            left: 0%;
            border: none;
            background: linear-gradient(145deg, rgba(255,255,255,0) 5%, rgba(110, 110, 110, 0.2) 100%);
            border-radius: 0px;
        }

        #schoolCards::before {
          content: "";
          position: absolute;
          top: 0;
          left: -1%;
          border-left: solid 7px rebeccapurple;
          transform: translateY(10%);
          height: 80%;
        }


		.duration{
		position:absolute;
		top:5%;
		color:rgb(122, 122, 122);
		}

    .col-2{
      position: relative;
      padding: 0%;
    }
    
    .col-3,.col-4,.col-5 {
      position: relative;
      padding-left: 5%;
    }

    .col-4{
      background-color: rgba(102, 51, 153, 0.25);
    }

    </style>
</head>
<body>
  <div class="container">
    <div class="row">
        <div class="col-5 information">
            <div class="row">
                <div class="col-2">                        
                  <h2>Informations</h2>
                  <div class="image-container">
                    <img src="assets/pictures/cv.webp" alt="Mon portrait par Mélanie Kosowski" >
                  </div>
                </div>
                <div class="col-2">                        
                  <h2 class="name">Arnaud LEMASÇON</h2>
                  <h5><div class="calcul" id="resultat"></div></h5> 
                  <h5>City : Lyon</h5>
                  <h5><div class="description">D'un naturel curieux, j'aime découvrir de nouveaux outils et technologies.</div></h5>
                </div>
            </div>
            <div class="EducationContainer">
              <h2>Education</h2>
            </div>
        </div>
        <div class="col-4">
          <h2>Positions</h2>
          <div id="cvContainer"></div>
      </div>

        <div class="col-3">
            <div class="certificationsContainer">
                <h2>Certifications</h2>
            </div>
        </div>
        <div class="col-1"></div>
    </div>
</div>


    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script>
        // Function to generate the CV from the Excel file
        function generateCVFromExcel(data) {
            const workbook = XLSX.read(data, { type: 'array' });
            const worksheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, raw: false });

            jsonData.sort((a, b) => new Date(b[0]) - new Date(a[0])); // Sort by descending start date

            let cvTemplate = '';

            jsonData.forEach((row) => {
                const startDate = new Date(row[0]);
                let endDate = new Date(row[1]);

                // Check if the end date is invalid
                if (isNaN(endDate)) {
                    endDate = new Date(); // Replace with today's date
                }

                const jobTitle = row[2];
                const companyName = row[3];
                const city = row[4];

                const cardTemplate = `
                    <div class="card">
                        <h5>${jobTitle}</h3>
                        <h6>${companyName} - ${city}</h4>
                        <p><h6 class="duration">${startDate.toLocaleDateString()} - ${endDate.toLocaleDateString()} (${calculateDuration(startDate, endDate)})</h6></p>
                    </div>
                `;

                cvTemplate += cardTemplate;
            });

            const cvContainer = document.getElementById('cvContainer');
            cvContainer.innerHTML = cvTemplate;
        }
		
// Function to generate cards from the second sheet of the Excel file
function generateCardsFromSheet2(data) {
  const workbook = XLSX.read(data, { type: 'array' });
  const worksheet = workbook.Sheets[workbook.SheetNames[1]];
  const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, raw: false });

  let cardTemplate = '';

  jsonData.forEach((row) => {
    const startDate = new Date(row[0]);
    let endDate = new Date(row[1]);

    // Check if the end date is invalid
    if (isNaN(endDate)) {
      endDate = new Date(); // Replace with today's date
    }

    const degree = row[2];
    const school = row[3];
    const city = row[4];

    const card = `
      <div class="card" id="schoolCards">
        <h5>${degree}</h5>
        <h6>${school} - ${city}</h5>
        <p><h6 class="duration">${startDate.toLocaleDateString()} - ${endDate.toLocaleDateString()} </h6></p>
      </div>
    `;

    cardTemplate += card;
  });

  const educationContainer = document.querySelector('.EducationContainer');
  educationContainer.innerHTML = `
    <h2>Education</h2>
    ${cardTemplate}
  `;
}
// Fonction pour générer une liste et compter les certifications LinkedIn à partir de la troisième feuille du fichier Excel
function generateLinkedInCertifications(data) {
  const workbook = XLSX.read(data, { type: 'array' });
  const worksheet = workbook.Sheets[workbook.SheetNames[2]];
  const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, raw: false });

  let linkedInCount = 0;
  let listTemplate = '';

  jsonData.forEach((row) => {
    const certification = row[0];
    const link = row[1];
    const school = row[2];
    const rawDate = row[3];

    if (school === 'LinkedIn') {
      linkedInCount++;
    } else {
      const formattedDate = formatDate(rawDate); // Format the date to DD/MM/YYYY

      const listItem = `
        <li>
          <a href="${link}">${certification} - ${school} - ${formattedDate}</a>
        </li>
      `;

      listTemplate += listItem;
    }
  });

  const linkedInCountElement = document.querySelector('.certificationsContainer');
  linkedInCountElement.innerHTML = `
    <h2>Certifications</h2>
    <ul>${listTemplate}</ul>
    <div>et ${linkedInCount} certifications LinkedIn ont été passées, sur divers sujets tels que la gestion de projets, les relations interpersonnel et l'agilité.<br><a href="https://www.linkedin.com/in/arnaud-lemas%C3%A7on-ness/details/certifications/">Liste exhaustive ici</a> </div>
  `;
}

// Fonction d'aide pour formater la date au format DD/MM/YYYY
function formatDate(rawDate) {
  const dateParts = rawDate.split('/');
  const day = dateParts[0].padStart(2, '0');
  const month = dateParts[1].padStart(2, '0');
  const year = `20${dateParts[2]}`; // En supposant que le format est J/M/AA où AA est l'année à deux chiffres

  return `${day}/${month}/${year}`;
}

	
		function generateCVOnLoad() {
  const excelUrl = 'https://raw.githubusercontent.com/SmurfNess/smurfness.github.io/main/assets/xlsx/data.xlsx';

  fetch(excelUrl)
    .then(response => response.arrayBuffer())
    .then(arrayBuffer => {
      generateCVFromExcel(arrayBuffer);
      generateCardsFromSheet2(arrayBuffer);
      generateLinkedInCertifications(arrayBuffer);
    })
    .catch(error => {
      console.error('An error occurred while retrieving the Excel file:', error);
    });
}


        function calculateDuration(startDate, endDate) {
            const diffInMilliseconds = endDate - startDate;
            const diffInDays = Math.floor(diffInMilliseconds / (1000 * 60 * 60 * 24));

            if (diffInDays < 0) {
                return ''; // If the difference is negative, return an empty string
            }

            const years = Math.floor(diffInDays / 365);
            const months = Math.floor((diffInDays % 365) / 30);
            const days = diffInDays % 30;

            let duration = '';
            if (years > 0) {
                duration += years === 1 ? '1 année' : `${years} années`;
            }
            if (months > 0) {
                duration += duration.length > 0 ? ' ' : '';
                duration += months === 1 ? '1 mois' : `${months} mois`;
            }
            if (days > 0) {
                duration += duration.length > 0 ? ' ' : '';
                duration += days === 1 ? '1 jour' : `${days} jours`;
            }

            return duration;
        }
		
		

        // Call the CV generation function on page load
        window.addEventListener('load', generateCVOnLoad);
		
        var anneeEnCours = new Date().getFullYear();
    var anneeInitiale = 1989;
    var resultat = anneeEnCours - anneeInitiale;
    
    var divResultat = document.getElementById("resultat");
    divResultat.textContent = "Age : " + resultat +" ans";
    </script>
</body>
</html>
